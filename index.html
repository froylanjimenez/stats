<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta Electoral</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2235;
    --surface3: #0d1420;
    --accent: #e8c84a;
    --accent2: #f97316;
    --text: #f0f4ff;
    --muted: #6b7a99;
    --border: #1e2d47;
    --success: #10b981;
    --error: #ef4444;
    --warning: #f59e0b;
    --info: #38bdf8;
    --purple: #a78bfa;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px 20px 60px;
    position: relative;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(232,200,74,0.025) 1px, transparent 1px),
      linear-gradient(90deg, rgba(232,200,74,0.025) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  body::after {
    content: '';
    position: fixed;
    top: -200px; right: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(232,200,74,0.06) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    width: 100%;
    max-width: 620px;
    position: relative;
    z-index: 1;
    padding-top: 40px;
  }

  /* â”€â”€â”€ HEADER â”€â”€â”€ */
  .header { text-align: center; margin-bottom: 40px; }
  .badge {
    display: inline-block;
    font-size: 11px; font-weight: 600;
    letter-spacing: 3px; text-transform: uppercase;
    color: var(--accent);
    border: 1px solid rgba(232,200,74,0.3);
    padding: 5px 14px; border-radius: 2px;
    margin-bottom: 18px;
  }
  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(42px, 8vw, 68px);
    letter-spacing: 2px; line-height: 1;
    color: var(--text); margin-bottom: 12px;
  }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 14px; font-weight: 300; }

  /* â”€â”€â”€ SEARCH CARD â”€â”€â”€ */
  .search-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 36px; margin-bottom: 24px;
    position: relative; overflow: hidden;
  }
  .search-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
  }
  label {
    display: block; font-size: 11px; font-weight: 600;
    letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted); margin-bottom: 10px;
  }
  .input-row { display: flex; gap: 10px; }
  input[type="text"] {
    flex: 1;
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 18px; font-weight: 500;
    padding: 14px 18px; border-radius: 3px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    letter-spacing: 1px;
  }
  input[type="text"]:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(232,200,74,0.08);
  }
  input[type="text"]::placeholder { color: var(--muted); font-size: 15px; letter-spacing: 0; }
  button {
    background: var(--accent); color: #0a0e1a;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 18px; letter-spacing: 1.5px;
    padding: 14px 28px; border-radius: 3px;
    cursor: pointer;
    transition: background 0.15s, transform 0.1s;
    white-space: nowrap;
  }
  button:hover { background: #f0d060; }
  button:active { transform: scale(0.97); }
  button:disabled { background: var(--muted); cursor: not-allowed; transform: none; }

  /* â”€â”€â”€ STATUS â”€â”€â”€ */
  .status-msg {
    text-align: center; font-size: 13px;
    padding: 12px; border-radius: 3px; margin-top: 16px;
    display: none; align-items: center; justify-content: center; gap: 10px;
  }
  .status-msg.error   { display: block; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); color: var(--error); }
  .status-msg.loading { display: flex; background: rgba(232,200,74,0.08); border: 1px solid rgba(232,200,74,0.2); color: var(--accent); }
  .spinner {
    width: 16px; height: 16px;
    border: 2px solid rgba(232,200,74,0.3);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite; flex-shrink: 0;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€â”€ RESULT CARD (Ãºnico) â”€â”€â”€ */
  .result-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; padding: 36px;
    display: none; position: relative; overflow: hidden;
    animation: slideUp 0.3s ease;
    margin-bottom: 24px;
  }
  .result-card.visible { display: block; }
  .result-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, var(--success), #34d399);
  }
  .result-header { display: flex; align-items: center; gap: 12px; margin-bottom: 28px; }
  .check-icon {
    width: 36px; height: 36px;
    background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.3);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
  }
  .result-name { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; line-height: 1.2; }
  .result-cedula { font-size: 12px; color: var(--muted); letter-spacing: 1px; }
  .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .info-item { background: var(--surface2); border: 1px solid var(--border); border-radius: 3px; padding: 16px; }
  .info-item.full { grid-column: 1 / -1; }
  .info-label { font-size: 10px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); margin-bottom: 6px; }
  .info-value { font-size: 16px; font-weight: 500; }
  .info-value.na { color: var(--muted); font-style: italic; font-size: 14px; }
  .info-value.highlight { color: var(--accent); font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 1px; }
  .unique-badge {
    display: inline-flex; align-items: center; gap: 6px;
    font-size: 11px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--success);
    background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3);
    padding: 5px 12px; border-radius: 2px; margin-top: 18px;
  }

  /* â”€â”€â”€ DUP CARD â”€â”€â”€ */
  .dup-card {
    background: var(--surface); border: 1px solid rgba(245,158,11,0.3);
    border-radius: 4px; padding: 36px;
    display: none; position: relative; overflow: hidden;
    animation: slideUp 0.3s ease; margin-bottom: 24px;
  }
  .dup-card.visible { display: block; }
  .dup-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, var(--warning), var(--accent2));
  }
  .dup-header { display: flex; align-items: center; gap: 12px; margin-bottom: 22px; }
  .warn-icon {
    width: 36px; height: 36px;
    background: rgba(245,158,11,0.12); border: 1px solid rgba(245,158,11,0.35);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 17px; flex-shrink: 0;
  }
  .dup-title { font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 1px; color: var(--warning); }
  .dup-cedula-label { font-size: 12px; color: var(--muted); letter-spacing: 1px; }
  .dup-count-pill {
    display: inline-block;
    background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.3);
    color: var(--warning); font-size: 12px; font-weight: 600; letter-spacing: 1px;
    padding: 3px 12px; border-radius: 20px; margin-bottom: 18px;
  }
  .dup-list { display: flex; flex-direction: column; gap: 10px; }
  .dup-entry {
    background: var(--surface2); border: 1px solid var(--border);
    border-left: 3px solid var(--warning); border-radius: 3px;
    padding: 14px 16px;
    display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 10px;
  }
  .dup-entry-nombre { font-size: 15px; font-weight: 500; }
  .dup-entry-meta { font-size: 12px; color: var(--muted); margin-top: 3px; }
  .dup-name-badge {
    display: inline-block; font-size: 11px; padding: 2px 8px;
    border-radius: 2px; margin-top: 5px; font-weight: 600; letter-spacing: 0.5px;
  }
  .dup-name-badge.match { background: rgba(16,185,129,0.15); color: var(--success); border: 1px solid rgba(16,185,129,0.3); }
  .dup-name-badge.diff  { background: rgba(239,68,68,0.12); color: var(--error); border: 1px solid rgba(239,68,68,0.3); }
  .dup-entry-puesto { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--accent); letter-spacing: 1px; text-align: right; }
  .dup-entry-puesto-label { font-size: 10px; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; text-align: right; }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STATS DASHBOARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .stats-panel {
    display: none;
    width: 100%;
    max-width: 900px;
    position: relative; z-index: 1;
    animation: slideUp 0.4s ease;
  }
  .stats-panel.visible { display: block; }

  .stats-header {
    text-align: center; margin-bottom: 36px;
  }
  .stats-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(36px, 6vw, 58px);
    letter-spacing: 3px; color: var(--text); line-height: 1;
  }
  .stats-title span { color: var(--accent); }
  .stats-subtitle { color: var(--muted); font-size: 13px; margin-top: 8px; }

  .stats-back {
    display: inline-flex; align-items: center; gap: 8px;
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--muted); font-size: 12px; font-weight: 600;
    letter-spacing: 1.5px; text-transform: uppercase;
    padding: 8px 16px; border-radius: 3px;
    cursor: pointer; margin-bottom: 30px;
    transition: color 0.15s, border-color 0.15s;
  }
  .stats-back:hover { color: var(--accent); border-color: rgba(232,200,74,0.4); }

  /* KPI Grid */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px; margin-bottom: 28px;
  }
  .kpi-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; padding: 20px 18px;
    position: relative; overflow: hidden;
  }
  .kpi-card::after {
    content: '';
    position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
  }
  .kpi-card.blue::after   { background: var(--info); }
  .kpi-card.green::after  { background: var(--success); }
  .kpi-card.yellow::after { background: var(--accent); }
  .kpi-card.orange::after { background: var(--accent2); }
  .kpi-card.red::after    { background: var(--error); }
  .kpi-card.purple::after { background: var(--purple); }

  .kpi-icon { font-size: 22px; margin-bottom: 10px; }
  .kpi-val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 38px; letter-spacing: 1px; line-height: 1; color: var(--text);
  }
  .kpi-label { font-size: 11px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; color: var(--muted); margin-top: 4px; }

  /* Section titles */
  .sec-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px; letter-spacing: 2px;
    color: var(--text); margin-bottom: 14px;
    display: flex; align-items: center; gap: 10px;
  }
  .sec-title::after {
    content: ''; flex: 1; height: 1px;
    background: var(--border);
  }
  .sec-title span { color: var(--accent); }

  /* LÃ­deres ranking */
  .lider-bar-row {
    display: flex; align-items: center; gap: 12px;
    margin-bottom: 10px;
  }
  .lider-rank {
    font-family: 'Bebas Neue', sans-serif; font-size: 18px;
    color: var(--muted); width: 28px; text-align: right; flex-shrink: 0;
  }
  .lider-name { font-size: 14px; font-weight: 500; min-width: 140px; flex-shrink: 0; }
  .lider-bar-wrap { flex: 1; background: var(--surface2); border-radius: 2px; height: 22px; overflow: hidden; }
  .lider-bar {
    height: 100%; border-radius: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    display: flex; align-items: center; padding-left: 8px;
    transition: width 0.8s cubic-bezier(.2,.8,.3,1);
    min-width: 30px;
  }
  .lider-bar-val { font-family: 'Bebas Neue', sans-serif; font-size: 15px; color: #0a0e1a; }
  .lider-pct { font-size: 12px; color: var(--muted); width: 42px; text-align: right; flex-shrink: 0; }

  /* Bottom lÃ­deres */
  .bottom-lider-row {
    display: flex; align-items: center; gap: 12px; margin-bottom: 10px;
  }
  .bottom-bar-wrap { flex: 1; background: var(--surface2); border-radius: 2px; height: 22px; overflow: hidden; }
  .bottom-bar {
    height: 100%; border-radius: 2px;
    background: linear-gradient(90deg, #374151, #4b5563);
    display: flex; align-items: center; padding-left: 8px;
    min-width: 30px;
  }
  .bottom-bar-val { font-family: 'Bebas Neue', sans-serif; font-size: 15px; color: #9ca3af; }

  /* Dups table */
  .dup-section { margin-bottom: 28px; }
  .dup-table-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; overflow: hidden; margin-bottom: 14px;
  }
  .dup-table-header {
    background: var(--surface2); padding: 14px 18px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
    cursor: pointer; user-select: none;
    transition: background 0.15s;
  }
  .dup-table-header:hover { background: #1f2d42; }
  .dup-table-cedula-num {
    font-family: 'Bebas Neue', sans-serif; font-size: 18px;
    letter-spacing: 1px; color: var(--text);
  }
  .dup-table-meta { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .dup-table-toggle { color: var(--accent); font-size: 18px; transition: transform 0.2s; }
  .dup-table-toggle.open { transform: rotate(180deg); }
  .dup-table-body { display: none; }
  .dup-table-body.open { display: block; }
  .dup-row {
    padding: 12px 18px; border-bottom: 1px solid var(--border);
    display: grid; grid-template-columns: 1fr 1fr auto;
    gap: 10px; align-items: center;
  }
  .dup-row:last-child { border-bottom: none; }
  .dup-row-lider { font-size: 13px; font-weight: 600; color: var(--text); }
  .dup-row-nombre { font-size: 13px; color: var(--muted); }
  .name-match-pill {
    font-size: 10px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase;
    padding: 3px 8px; border-radius: 2px;
  }
  .name-match-pill.yes { background: rgba(16,185,129,0.15); color: var(--success); }
  .name-match-pill.no  { background: rgba(239,68,68,0.12); color: var(--error); }
  .dup-consistency-badge {
    font-size: 11px; font-weight: 600; letter-spacing: 1px;
    padding: 4px 10px; border-radius: 2px; margin-left: 8px;
  }
  .dup-consistency-badge.ok  { background: rgba(16,185,129,0.1); color: var(--success); border: 1px solid rgba(16,185,129,0.25); }
  .dup-consistency-badge.bad { background: rgba(239,68,68,0.1); color: var(--error); border: 1px solid rgba(239,68,68,0.25); }

  /* Lugares */
  .lugar-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 28px;
  }
  .lugar-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: 3px;
    padding: 14px 16px;
    display: flex; align-items: center; gap: 12px;
  }
  .lugar-count {
    font-family: 'Bebas Neue', sans-serif; font-size: 28px;
    color: var(--accent); flex-shrink: 0; min-width: 50px;
  }
  .lugar-name { font-size: 13px; font-weight: 500; line-height: 1.3; }
  .lugar-pct  { font-size: 11px; color: var(--muted); }

  /* Loading overlay for stats */
  .stats-loading {
    display: none; text-align: center; padding: 60px 20px;
    position: relative; z-index: 1;
  }
  .stats-loading.visible { display: block; }
  .stats-loading-spinner {
    width: 40px; height: 40px; margin: 0 auto 16px;
    border: 3px solid rgba(232,200,74,0.2);
    border-top-color: var(--accent);
    border-radius: 50%; animation: spin 0.8s linear infinite;
  }
  .stats-loading-text {
    font-family: 'Bebas Neue', sans-serif; font-size: 20px;
    letter-spacing: 2px; color: var(--muted);
  }

  /* â”€â”€ NUEVO: Resumen global â”€â”€ */
  .global-strip {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
    margin-bottom: 28px;
  }
  .gs-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; padding: 14px 16px;
    border-top: 2px solid var(--accent);
  }
  .gs-val {
    font-family: 'Bebas Neue', sans-serif; font-size: 34px;
    color: var(--accent); line-height: 1;
  }
  .gs-val.red   { color: var(--error); }
  .gs-val.green { color: var(--success); }
  .gs-label {
    font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
    text-transform: uppercase; color: var(--muted); margin-top: 4px;
  }

  /* â”€â”€ NUEVO: Tabla de lÃ­deres â”€â”€ */
  .lt-wrap {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; overflow: hidden; margin-bottom: 28px;
  }
  .lt-head {
    display: grid; grid-template-columns: 1fr 90px 90px 90px;
    padding: 9px 14px; background: var(--surface3); gap: 8px;
  }
  .lt-head span {
    font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
    text-transform: uppercase; color: var(--muted);
  }
  .lt-head span:not(:first-child) { text-align: center; }
  .lt-row {
    display: grid; grid-template-columns: 1fr 90px 90px 90px;
    padding: 11px 14px; gap: 8px; align-items: center;
    border-top: 1px solid var(--border);
    transition: background 0.1s;
  }
  .lt-row:hover { background: var(--surface2); }
  .lt-nombre { font-size: 13px; font-weight: 600; color: var(--text); }
  .lt-nombre small { display: block; font-size: 11px; font-weight: 400; color: var(--muted); margin-top: 1px; }
  .lt-num {
    font-family: 'Bebas Neue', sans-serif; font-size: 22px;
    text-align: center; color: var(--text);
  }
  .lt-num.warn { color: var(--warning); }
  .lt-num.red  { color: var(--error); }
  .lt-pct-bar { display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .lt-pct-txt { font-size: 12px; color: var(--accent); font-weight: 600; }
  .lt-bar-track {
    width: 100%; height: 4px; background: var(--surface3);
    border-radius: 2px; overflow: hidden;
  }
  .lt-bar-fill {
    height: 100%; border-radius: 2px;
    background: linear-gradient(90deg, var(--success), var(--accent));
  }
  .lt-bar-fill.warn { background: linear-gradient(90deg, var(--warning), var(--error)); }

  /* â”€â”€ NUEVO: SecciÃ³n de duplicados por lÃ­der (imprimible) â”€â”€ */
  .print-btn {
    background: rgba(232,200,74,0.1); border: 1px solid var(--accent);
    color: var(--accent); font-family: 'Bebas Neue', sans-serif;
    font-size: 14px; letter-spacing: 2px; padding: 8px 20px;
    border-radius: 3px; cursor: pointer; margin-bottom: 20px;
    transition: all 0.15s;
  }
  .print-btn:hover { background: var(--accent); color: var(--bg); }

  .lider-dup-block {
    margin-bottom: 20px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; overflow: hidden;
  }
  .ldb-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 16px; background: var(--surface3);
    border-bottom: 1px solid var(--border); gap: 12px; flex-wrap: wrap;
  }
  .ldb-name {
    font-family: 'Bebas Neue', sans-serif; font-size: 20px;
    letter-spacing: 1px; color: var(--accent);
  }
  .ldb-chips { display: flex; gap: 8px; flex-wrap: wrap; }
  .ldb-chip {
    font-size: 11px; font-weight: 600; letter-spacing: 0.5px;
    padding: 3px 10px; border-radius: 2px;
  }
  .ldb-chip.total  { background: rgba(56,189,248,0.12); color: var(--info); border: 1px solid rgba(56,189,248,0.25); }
  .ldb-chip.rep    { background: rgba(245,158,11,0.12); color: var(--warning); border: 1px solid rgba(245,158,11,0.25); }
  .ldb-chip.dist   { background: rgba(239,68,68,0.12); color: var(--error); border: 1px solid rgba(239,68,68,0.25); }

  /* tabla dentro del bloque */
  .ldb-table { width: 100%; border-collapse: collapse; }
  .ldb-table th {
    font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
    text-transform: uppercase; color: var(--muted);
    padding: 7px 14px; text-align: left;
    background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--border);
  }
  .ldb-table td {
    font-size: 13px; padding: 9px 14px;
    border-bottom: 1px solid rgba(30,45,71,0.5);
    vertical-align: top; color: var(--text);
  }
  .ldb-table tr:last-child td { border-bottom: none; }
  .ldb-table tr:hover td { background: rgba(232,200,74,0.03); }
  .td-ced {
    font-family: 'Bebas Neue', sans-serif; font-size: 16px;
    color: var(--text); white-space: nowrap;
  }
  .td-nombre { font-weight: 600; }
  .td-otros { font-size: 12px; color: var(--muted); line-height: 1.6; }
  .td-otros strong { color: var(--text); font-weight: 600; }
  .name-diff {
    display: inline-block; font-size: 10px; font-weight: 700;
    letter-spacing: 0.5px; padding: 1px 6px; border-radius: 2px;
    background: rgba(239,68,68,0.15); color: var(--error);
    margin-left: 4px; vertical-align: middle;
  }
  .name-ok {
    display: inline-block; font-size: 10px; font-weight: 700;
    letter-spacing: 0.5px; padding: 1px 6px; border-radius: 2px;
    background: rgba(16,185,129,0.12); color: var(--success);
    margin-left: 4px; vertical-align: middle;
  }

  @media (max-width: 600px) {
    .global-strip { grid-template-columns: 1fr 1fr; }
    .lt-head { grid-template-columns: 1fr 70px 70px; }
    .lt-head span:last-child { display: none; }
    .lt-row { grid-template-columns: 1fr 70px 70px; }
    .lt-row > div:last-child { display: none; }
    .lider-name { min-width: 100px; font-size: 12px; }
    .stats-panel { max-width: 100%; }
  }

  /* â”€â”€ PRINT â”€â”€ */
  @media print {
    body { background: #fff !important; color: #000 !important; padding: 0 !important; }
    body::before { display: none; }
    .stats-back, .print-btn, .stats-loading { display: none !important; }
    .stats-panel { max-width: 100% !important; padding: 0 !important; }
    .stats-header { background: #0d2818 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .lider-dup-block { break-inside: avoid; page-break-inside: avoid; }
    .lt-wrap, .global-strip { break-inside: avoid; }
    .ldb-table td, .ldb-table th { border-color: #ccc !important; }
    .ldb-header { background: #1a4a2e !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .ldb-name { color: #ffffff !important; }
    .ldb-chip { color: #ffffff !important; border-color: rgba(255,255,255,0.4) !important; background: rgba(255,255,255,0.15) !important; }
    :root {
      --surface: #f9f9f9; --surface2: #f0f0f0; --surface3: #e8e8e8;
      --border: #ddd; --text: #111; --muted: #555;
      --accent: #1a4a2e; --warning: #b45309; --error: #b91c1c;
      --success: #15803d; --info: #0369a1;
    }
  }
</style>
</head>
<body>

<!-- â”€â”€ SEARCH PANEL â”€â”€ -->
<div class="container" id="searchPanel">
  <div class="header">
    <div class="badge">Sistema Electoral</div>
    <h1>CONSULTA<br><span>VOTANTE</span></h1>
    <p class="subtitle">Ingresa tu cÃ©dula â€” escribe <strong style="color:var(--accent)">stats</strong> para ver estadÃ­sticas</p>
  </div>

  <div class="search-card">
    <label for="cedula">NÃºmero de cÃ©dula</label>
    <div class="input-row">
      <input type="text" id="cedula" placeholder="Ej: 1082405787 o stats" maxlength="20" inputmode="numeric" />
      <button id="btnBuscar" onclick="buscar()">BUSCAR</button>
    </div>
    <div class="status-msg" id="statusMsg"></div>
  </div>

  <!-- Resultado Ãºnico -->
  <div class="result-card" id="resultCard">
    <div class="result-header">
      <div class="check-icon">âœ“</div>
      <div>
        <div class="result-name" id="resNombre">â€”</div>
        <div class="result-cedula" id="resCedula">â€”</div>
      </div>
    </div>
    <div class="info-grid">
      <div class="info-item full">
        <div class="info-label">ğŸ“ Lugar de VotaciÃ³n</div>
        <div class="info-value" id="resLugar">â€”</div>
      </div>
      <div class="info-item">
        <div class="info-label">ğŸ—³ï¸ Mesa (Puesto)</div>
        <div class="info-value highlight" id="resPuesto">â€”</div>
      </div>
      <div class="info-item">
        <div class="info-label">ğŸ‘¤ LÃ­der</div>
        <div class="info-value" id="resLider">â€”</div>
      </div>
    </div>
    <div class="unique-badge" id="uniqueBadge">âœ” Registro Ãºnico â€” sin duplicados</div>
  </div>

  <!-- Duplicados -->
  <div class="dup-card" id="dupCard">
    <div class="dup-header">
      <div class="warn-icon">âš ï¸</div>
      <div>
        <div class="dup-title">CÃ‰DULA DUPLICADA</div>
        <div class="dup-cedula-label" id="dupCedula">â€”</div>
      </div>
    </div>
    <div class="dup-count-pill" id="dupCountPill">â€” registros encontrados</div>
    <div class="dup-list" id="dupList"></div>
  </div>
</div>

<!-- â”€â”€ STATS LOADING â”€â”€ -->
<div class="stats-loading" id="statsLoading">
  <div class="stats-loading-spinner"></div>
  <div class="stats-loading-text">CARGANDO ESTADÃSTICAS...</div>
</div>

<!-- â”€â”€ STATS PANEL â”€â”€ -->
<div class="stats-panel" id="statsPanel">
  <button class="stats-back" onclick="volverBusqueda()">â† VOLVER A CONSULTA</button>

  <div class="stats-header">
    <div class="badge">AnÃ¡lisis de Base de Datos</div>
    <div class="stats-title">CÃ‰DULAS<br><span>DUPLICADAS</span></div>
    <div class="stats-subtitle" id="statsTimestamp">â€”</div>
  </div>

  <!-- Resumen global -->
  <div class="global-strip" id="globalStrip"></div>

  <!-- Tabla resumen lÃ­deres -->
  <div class="sec-title">RESUMEN <span>POR LÃDER</span></div>
  <div class="lt-wrap">
    <div class="lt-head">
      <span>LÃ­der</span>
      <span>Total reg.</span>
      <span>Duplicados</span>
      <span>% duplicado</span>
    </div>
    <div id="liderTable"></div>
  </div>

  <!-- BotÃ³n imprimir -->
  <button class="print-btn" onclick="window.print()">ğŸ–¨ IMPRIMIR / GUARDAR PDF</button>

  <!-- Detalle duplicados por lÃ­der -->
  <div class="sec-title">DETALLE DE DUPLICADOS <span>POR LÃDER</span></div>
  <div id="dupDetalle"></div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxD6GFonTCEgeIee96dnazo_t_tvmTf2zyfKCJSAyb08wzYnOhGvgjFVC9PL86EW0-sKw/exec';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showStatus(msg, type) {
  const el = document.getElementById('statusMsg');
  el.innerHTML = type === 'loading' ? `<div class="spinner"></div>${msg}` : msg;
  el.className = 'status-msg ' + type;
}
function hideStatus() { document.getElementById('statusMsg').className = 'status-msg'; }
function hideAllResults() {
  document.getElementById('resultCard').classList.remove('visible');
  document.getElementById('dupCard').classList.remove('visible');
}
function setField(id, value, highlight = false) {
  const el = document.getElementById(id);
  const empty = !value || value.toString().trim() === '' || value === 'No aplica';
  el.textContent = empty ? 'No aplica' : value;
  el.className = 'info-value' + (highlight && !empty ? ' highlight' : '') + (empty ? ' na' : '');
}
function volverBusqueda() {
  document.getElementById('statsPanel').classList.remove('visible');
  document.getElementById('statsLoading').classList.remove('visible');
  document.getElementById('searchPanel').style.display = 'flex';
  document.getElementById('cedula').value = '';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BÃšSQUEDA PRINCIPAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function buscar() {
  const raw = document.getElementById('cedula').value.trim();

  // â”€â”€ Comando stats â”€â”€
  if (raw.toLowerCase() === 'stats') {
    cargarStats();
    return;
  }

  const cedula = raw;
  if (!cedula) { showStatus('Por favor ingresa un nÃºmero de cÃ©dula.', 'error'); return; }

  const btn = document.getElementById('btnBuscar');
  btn.disabled = true;
  hideAllResults();
  showStatus('Consultando...', 'loading');

  try {
    const res = await fetch(`${SCRIPT_URL}?cedula=${encodeURIComponent(cedula)}`);
    if (!res.ok) throw new Error();
    const data = await res.json();
    handleResponse(data, cedula);
  } catch {
    showStatus('âš ï¸ Error al conectar con el servidor. Intenta de nuevo.', 'error');
  }
  btn.disabled = false;
}

function handleResponse(data, cedula) {
  hideStatus(); hideAllResults();
  if (!data.found) { showStatus('âŒ CÃ©dula no encontrada en el registro.', 'error'); return; }

  let registros = Array.isArray(data.registros) && data.registros.length
    ? data.registros
    : [{ nombre: data.nombre, lider: data.lider, lugar: data.lugar, puesto: data.puesto }];

  if (registros.length === 1) {
    const r = registros[0];
    document.getElementById('resNombre').textContent = r.nombre || 'No aplica';
    document.getElementById('resCedula').textContent = 'CC ' + cedula;
    setField('resLugar', r.lugar);
    setField('resPuesto', r.puesto, true);
    setField('resLider', r.lider);
    document.getElementById('uniqueBadge').style.display = 'inline-flex';
    document.getElementById('resultCard').classList.add('visible');
  } else {
    document.getElementById('dupCedula').textContent = 'CC ' + cedula;
    document.getElementById('dupCountPill').textContent = registros.length + ' registros encontrados para esta cÃ©dula';

    const nombreRef = (registros[0].nombre || '').trim().toUpperCase();
    const allMatch = registros.every(r => (r.nombre || '').trim().toUpperCase() === nombreRef);

    const list = document.getElementById('dupList');
    list.innerHTML = '';
    registros.forEach(r => {
      const lider  = r.lider  || 'Sin lÃ­der';
      const lugar  = r.lugar  || 'No aplica';
      const puesto = r.puesto || 'â€”';
      const nombre = r.nombre || 'Sin nombre';
      const matchesRef = (nombre.trim().toUpperCase() === nombreRef);

      const entry = document.createElement('div');
      entry.className = 'dup-entry';
      entry.innerHTML = `
        <div>
          <div class="dup-entry-nombre">ğŸ‘¤ ${lider}</div>
          <div class="dup-entry-meta">${lugar}</div>
          <div>
            <span class="dup-name-badge ${matchesRef && !allMatch ? 'match' : (!matchesRef ? 'diff' : 'match')}">
              ${nombre}
            </span>
            ${!allMatch && !matchesRef ? '<span class="dup-name-badge diff" style="margin-left:4px">Nombre diferente</span>' : ''}
          </div>
        </div>
        <div>
          <div class="dup-entry-puesto">${puesto}</div>
          <div class="dup-entry-puesto-label">Mesa</div>
        </div>
      `;
      list.appendChild(entry);
    });
    document.getElementById('dupCard').classList.add('visible');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function cargarStats() {
  document.getElementById('searchPanel').style.display = 'none';
  document.getElementById('statsLoading').classList.add('visible');

  try {
    const res = await fetch(`${SCRIPT_URL}?action=stats`);
    if (!res.ok) throw new Error();
    const data = await res.json();
    renderStats(data);
  } catch {
    // Si el backend no soporta ?action=stats, muestra error elegante
    document.getElementById('statsLoading').classList.remove('visible');
    document.getElementById('searchPanel').style.display = 'flex';
    showStatus('âš ï¸ El servidor no soporta estadÃ­sticas o hubo un error de conexiÃ³n.', 'error');
  }
}

function renderStats(data) {
  document.getElementById('statsLoading').classList.remove('visible');

  /*
    Backend devuelve:
    {
      total, totalUnicos, totalLideres, totalLugares,
      lideres: [ { nombre, count } ],
      duplicados: [ { cedula, registros: [ { lider, nombre, puesto, lugar } ] } ]
    }
  */

  const now = new Date();
  document.getElementById('statsTimestamp').textContent =
    'Generado el ' + now.toLocaleDateString('es-CO', { day:'2-digit', month:'long', year:'numeric' })
    + ' a las ' + now.toLocaleTimeString('es-CO', { hour:'2-digit', minute:'2-digit' });

  const total   = data.total || 0;
  const unicos  = data.totalUnicos || 0;
  const lideres = data.lideres || [];
  const dups    = data.duplicados || [];

  // â”€â”€ Ãndice: total registros por lÃ­der â”€â”€
  const totalPorLider = {};
  lideres.forEach(l => { totalPorLider[l.nombre] = l.count; });

  // â”€â”€ Ãndice: duplicados por lÃ­der â”€â”€
  const dupsPorLider = {};
  lideres.forEach(l => { dupsPorLider[l.nombre] = []; });
  dups.forEach(d => {
    const lidersEnCed = [...new Set(d.registros.map(r => r.lider))];
    d.registros.forEach(r => {
      const ml = r.lider;
      if (!dupsPorLider[ml]) dupsPorLider[ml] = [];
      // Evitar duplicar la misma cÃ©dula para el mismo lÃ­der
      if (!dupsPorLider[ml].find(x => x.cedula === d.cedula)) {
        dupsPorLider[ml].push({
          cedula: d.cedula,
          mi_nombre: r.nombre,
          otros: d.registros
            .filter(x => x.lider !== ml)
            .map(x => ({ lider: x.lider, nombre: x.nombre }))
        });
      }
    });
  });

  // â”€â”€ Similitud de nombres â”€â”€
  function simNombre(a, b) {
    const ta = new Set((a||'').toUpperCase().split(/\s+/).filter(Boolean));
    const tb = new Set((b||'').toUpperCase().split(/\s+/).filter(Boolean));
    if (!ta.size || !tb.size) return false;
    let n = 0; ta.forEach(t => { if (tb.has(t)) n++; });
    return (n / (ta.size + tb.size - n)) >= 0.5;
  }

  // â”€â”€ Resumen global â”€â”€
  const totalDupCeds = dups.length;
  document.getElementById('globalStrip').innerHTML = [
    { v: total.toLocaleString('es-CO'), l: 'Total registros', cls: '' },
    { v: unicos.toLocaleString('es-CO'), l: 'CÃ©dulas Ãºnicas', cls: 'green' },
    { v: totalDupCeds, l: 'CÃ©dulas duplicadas', cls: 'red' },
    { v: lideres.length, l: 'LÃ­deres activos', cls: '' },
  ].map(k => `
    <div class="gs-card">
      <div class="gs-val ${k.cls}">${k.v}</div>
      <div class="gs-label">${k.l}</div>
    </div>`).join('');

  // â”€â”€ Tabla resumen por lÃ­der â”€â”€
  const lideresOrdenados = [...lideres].sort((a,b) => b.count - a.count);
  document.getElementById('liderTable').innerHTML = lideresOrdenados.map(l => {
    const nDups = (dupsPorLider[l.nombre] || []).length;
    const pctDup = l.count > 0 ? ((nDups / l.count) * 100).toFixed(1) : 0;
    const barW = Math.min(100, parseFloat(pctDup));
    const warn = barW > 15;
    return `
      <div class="lt-row">
        <div>
          <div class="lt-nombre">${l.nombre}</div>
          <div class="lt-nombre"><small>${nDups} de ${l.count} registros repetidos</small></div>
        </div>
        <div class="lt-num">${l.count}</div>
        <div class="lt-num ${warn ? 'warn' : ''}">${nDups}</div>
        <div class="lt-pct-bar">
          <div class="lt-pct-txt">${pctDup}%</div>
          <div class="lt-bar-track">
            <div class="lt-bar-fill ${warn ? 'warn' : ''}" style="width:${barW}%"></div>
          </div>
        </div>
      </div>`;
  }).join('');

  // â”€â”€ Detalle duplicados por lÃ­der â”€â”€
  const detalle = document.getElementById('dupDetalle');
  const bloques = lideresOrdenados.map(l => {
    const items = dupsPorLider[l.nombre] || [];
    if (!items.length) return '';

    const distintos = items.filter(i =>
      i.otros.some(o => !simNombre(i.mi_nombre, o.nombre))
    ).length;

    const filas = items.map(item => {
      const otrosHtml = item.otros.map(o => {
        const igual = simNombre(item.mi_nombre, o.nombre);
        return `<strong>${o.lider}</strong>: ${o.nombre || 'â€”'} `
          + (igual
            ? `<span class="name-ok">âœ“ igual</span>`
            : `<span class="name-diff">âœ— distinto</span>`);
      }).join('<br>');

      return `<tr>
        <td><div class="td-ced">${item.cedula}</div></td>
        <td><div class="td-nombre">${item.mi_nombre || 'â€”'}</div></td>
        <td><div class="td-otros">${otrosHtml}</div></td>
      </tr>`;
    }).join('');

    return `
      <div class="lider-dup-block">
        <div class="ldb-header">
          <div class="ldb-name">${l.nombre}</div>
          <div class="ldb-chips">
            <span class="ldb-chip total">Total: ${l.count}</span>
            <span class="ldb-chip rep">Duplicados: ${items.length}</span>
            ${distintos > 0 ? `<span class="ldb-chip dist">Nombre distinto: ${distintos}</span>` : ''}
          </div>
        </div>
        <table class="ldb-table">
          <thead>
            <tr>
              <th style="width:120px">CÃ©dula</th>
              <th>Nombre en este lÃ­der</th>
              <th>Compartido con</th>
            </tr>
          </thead>
          <tbody>${filas}</tbody>
        </table>
      </div>`;
  }).join('');

  detalle.innerHTML = bloques || `<div style="color:var(--success);padding:20px;text-align:center;">âœ… Sin duplicados.</div>`;

  document.getElementById('statsPanel').classList.add('visible');
}



/* â”€â”€â”€ Enter key â”€â”€â”€ */
document.getElementById('cedula').addEventListener('keydown', e => {
  if (e.key === 'Enter') buscar();
});
</script>
</body>
</html>
